<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chtholly Treeï¼ˆç‚æœµè‰æ¨¹ï¼‰èˆ‡ Codeforces 896C é¡Œè§£</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">

    <script src="prism.js"></script>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
    <!-- Prism.js CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <!-- Prism.js JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
</head>

<body>
    <div class="content-container">
        <h1>Chtholly Treeï¼ˆç‚æœµè‰æ¨¹ï¼‰èˆ‡ Codeforces 896C é¡Œè§£</h1>

        <div class="meta-info">
            <div>
                <i class="fas fa-calendar"></i>
                2025-02-08
            </div>
            <div>
                <i class="fas fa-clock"></i>
                10åˆ†é˜é–±è®€
            </div>
        </div>

        <h2>å‰è¨€</h2>

        <p>ç‚æœµè‰æ¨¹ï¼ˆChtholly Treeï¼‰èµ·æºæ–¼ <a href="https://codeforces.com/problemset/problem/896/C">CF 896C</a>ï¼Œåå­—èµ·æºæ–¼<span
                style="color: blue;">æœ«æ—¥ä¸‰å•</span>çš„ç‚æœµè‰ï¼Œå…ˆæ˜¯ä»‹ç´¹åŠ‡æƒ…ç„¶å¾Œè¬›åˆ°è–åŠçš„è­·èº«ç¬¦çµ„æˆå†å¸¶åˆ°ç¨‹å¼ã€‚</p>
        <p>ç‚æœµè‰æ¨¹æ˜¯ä¸€ç¨®æš´åŠ›è³‡æ–™çµæ§‹ï¼Œå¸¸ç”¨æ–¼æœ‰å¤§é‡å€é–“æ¨å¹³æ“ä½œè€Œè³‡æ–™éš¨æ©Ÿçš„é¡Œç›®ï¼Œå¦‚æœè³‡æ–™ä¸éš¨æ©Ÿä¹Ÿå¯ä»¥ç”¨ä¾†é¨™åˆ†ã€‚</p>
        <img src="Chtholly.jpg" alt="Chtholly" class="placeholder-image" width="600" height="400">


        <h2>Chtholly Tree çš„æ ¸å¿ƒæ¦‚å¿µ</h2>
        <div class="section">
            <h3>1. ä»€éº¼æ˜¯ Chtholly Treeï¼Ÿ</h3>
            <p>Chtholly Tree çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°‡æ•¸åˆ—åŠƒåˆ†ç‚ºã€Œå€¼ç›¸åŒçš„å€é–“ã€ï¼Œç”¨ <code>std::set</code>
                å­˜å„²å€é–“è³‡è¨Šã€‚ç•¶å€é–“ç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œåªæ‹†åˆ†å—å½±éŸ¿çš„éƒ¨åˆ†ï¼Œä¿æŒå…¶ä»–å€é–“ä¸è®Šï¼Œå¾è€Œæ¸›å°‘æ“ä½œæ¬¡æ•¸ã€‚å€é–“åˆä½µï¼šå¦‚æœç›¸é„°å€é–“çš„å€¼ç›¸åŒï¼Œå‰‡åˆä½µç‚ºä¸€å€‹å€é–“ï¼Œä»¥é™ä½æ•¸æ“šçµæ§‹çš„å¤§å°ï¼Œæé«˜é‹è¡Œæ•ˆç‡ã€‚</p>
        </div>


        <div class="section">
            <h3>2. ä»€éº¼æ™‚å€™ä½¿ç”¨ Chtholly Treeï¼Ÿ</h3>
            <p>âœ… é©åˆå ´æ™¯ï¼š</p>
            <ul>
                <li>å€é–“åŠ æ³• / ä¹˜æ³•</li>
                <li>å€é–“è³¦å€¼</li>
                <li>å€é–“ç¬¬ k å°</li>
                <li>å€é–“å†ªå’Œ</li>
                <li>å‹•æ…‹ç¶­è­·å€é–“</li>
            </ul>
            <p>âŒ ä¸é©åˆå ´æ™¯ï¼š</p>
            <ul>
                <li>å–®é»æŸ¥è©¢èˆ‡ä¿®æ”¹ï¼ˆç·šæ®µæ¨¹æˆ–æ¨¹ç‹€æ•¸çµ„æ›´å¿«ï¼‰</li>
                <li>æ•¸æ“šééš¨æ©Ÿï¼Œæƒ¡æ„æ§‹é€ æ¸¬è³‡å¯èƒ½å°è‡´è¶…æ™‚</li>
                <li>é »ç¹æŸ¥è©¢å€é–“å’Œï¼ˆéœ€ O(m) éæ­·ï¼Œå¯èƒ½æ¯”ç·šæ®µæ¨¹æ…¢ï¼‰</li>
            </ul>
        </div>
        <h2>Codeforces 896C é¡Œç›®</h2>
        <div class="section">

            <h3>é¡Œç›®æè¿°</h3>
            <br>
            <a href="https://codeforces.com/problemset/problem/896/C">åŸæ–‡é¡Œç›®é€£çµ</a>
            <p>çµ¦å®šä¸€å€‹é•·åº¦ç‚º \( n \) çš„æ•¸åˆ— \( a \)ï¼Œä»¥åŠ \( m \) å€‹æ“ä½œï¼Œæ“ä½œåˆ†ç‚ºä»¥ä¸‹å››ç¨®ï¼š</p>
            <ol>
                <li>å€é–“åŠ æ³•ï¼šå°‡å€é–“ \([l, r]\) å…§çš„æ‰€æœ‰æ•¸åŠ ä¸Š \( x \)ã€‚</li>
                <li>å€é–“è³¦å€¼ï¼šå°‡å€é–“ \([l, r]\) å…§çš„æ‰€æœ‰æ•¸è¨­ç‚º \( x \)ã€‚</li>
                <li>å€é–“ç¬¬ k å°ï¼šæŸ¥è©¢å€é–“ \([l, r]\) å…§çš„ç¬¬ k å°çš„æ•¸ã€‚</li>
                <li>å€é–“å†ªå’Œï¼šè¨ˆç®—å€é–“ \([l, r]\) å…§æ‰€æœ‰æ•¸çš„ \( x \) æ¬¡æ–¹çš„å’Œï¼Œä¸¦å° \( y \) å–æ¨¡ã€‚</li>
            </ol>
            <p>è«‹å¯¦ç¾ä¸€å€‹ç¨‹åºï¼Œè™•ç†é€™äº›æ“ä½œã€‚</p>
        </div>
        <div class="section">
            <h3>è¼¸å…¥æ ¼å¼</h3>
            <br>
            <p>é€™é“é¡Œç›®çš„è¼¸å…¥æ ¼å¼æ¯”è¼ƒç‰¹æ®Šï¼Œéœ€è¦é¸æ‰‹é€šé <code>seed</code> è‡ªå·±ç”Ÿæˆè¼¸å…¥æ•¸æ“šã€‚è¼¸å…¥ä¸€è¡Œå››å€‹æ•´æ•¸ï¼š</p>
            <pre><code>n, m, seed, Vmax</code></pre>
            <p>å…¶ä¸­ï¼š</p>
            <ul>
                <li>n è¡¨ç¤ºæ•¸åˆ—é•·åº¦ã€‚</li>
                <li>m è¡¨ç¤ºæ“ä½œæ¬¡æ•¸ã€‚</li>
                <li>seed å’Œ Vmax ç”¨æ–¼ç”Ÿæˆè¼¸å…¥æ•¸æ“šã€‚</li>
            </ul>
            <p>æ•¸æ“šç”Ÿæˆçš„å½ä»£ç¢¼å¦‚ä¸‹ï¼š</p>
            <pre><code class="language-css">def rnd():

    ret = seed
    seed = (seed * 7 + 13) mod 1000000007
    return ret

for i = 1 to n:

    a[i] = (rnd() mod vmax) + 1

for i = 1 to m:

    op = (rnd() mod 4) + 1
    l = (rnd() mod n) + 1
    r = (rnd() mod n) + 1

    if (l > r): 
            swap(l, r)

    if (op == 3):
        x = (rnd() mod (r - l + 1)) + 1
    else:
        x = (rnd() mod vmax) + 1

    if (op == 4):
        y = (rnd() mod vmax) + 1
    </code></pre>
        </div>
        <div class="section">
            <h3>è¼¸å‡ºæ ¼å¼</h3>
            <p>å°æ–¼æ¯å€‹æ“ä½œ 3 å’Œ 4ï¼Œè¼¸å‡ºå°æ‡‰çš„çµæœã€‚</p>
        </div>

        <div class="section">
            <h3>ç¯„ä¾‹è¼¸å…¥</h3>
            <pre><code class="language-plaintext">10 10 7 9
1 3 9 3 0
2 1 4 8 0
3 1 10 1 0
4 2 6 9 7</code></pre>
        </div>

        <div class="section">
            <h3>ç¯„ä¾‹è¼¸å‡º</h3>
            <pre><code class="language-plaintext">8
1</code></pre>
        </div>


        <h2>Chtholly Tree çš„æ ¸å¿ƒå‡½æ•¸</h2>
        <div class="section">
            <h3>1. Node çµæ§‹</h3>
            <p><br>Chtholly Tree çš„æ ¸å¿ƒå¯¦ä½œä¾è³´ <code>std::set&lt;Node&gt;</code>
                å…¶ä¸­ <code>Node</code> å®šç¾©å¦‚ä¸‹ï¼š</p>
            <pre><code class="language-css">#include &lt;bits/stdc++.h&gt;
using namespace std;
#define int long long

struct Node {
    int l, r;
    int val;
};

signed main() {
    Node node = {1, 2, 3};
    cout &lt;&lt; "Hello, World!" &lt;&lt; endl;
    return 0;</code></pre>
            <p>å…¶ä¸­ï¼š</p>
            <ul>
                <li><code>l, r</code> è¡¨ç¤ºå€é–“ [l, r]</li>
                <li><code>v</code> è¡¨ç¤ºå€é–“å…§çš„å€¼</li>
                <li><code>operator&lt;</code> è®“ <code>std::set</code> æŒ‰ç…§ <code>l</code> æ’åº</li>
            </ul>
        </div>

        <div class="section">
            <h3>2. split(x) - å€é–“åˆ†è£‚</h3>
            <p><br>ç•¶æˆ‘å€‘éœ€è¦ä¿®æ”¹ [l, r] çš„å€é–“æ™‚ï¼Œé¦–å…ˆè¦ç¢ºä¿ l å’Œ r æ˜¯æŸå€‹å€é–“çš„é‚Šç•Œï¼Œå¦‚æœä¸æ˜¯ï¼Œå‰‡ä½¿ç”¨ split(x) ä¾†æ‹†åˆ†å€é–“ï¼š</p>
            <pre><code class="language-css">it split(int x) {
    if (x > n) return ct.end();
        it iter = --ct.upper_bound(Node(x, 0, 0));
    if (iter->l == x) return iter;
    int l = iter->l, r = iter->r, v = iter->v;
    ct.erase(iter);
    ct.insert(Node(l, x - 1, v));
    return ct.insert(Node(x, r, v)).first;
}</code></pre>
            <p>ğŸ”¹ æ™‚é–“è¤‡é›œåº¦ï¼šO(log n)ï¼ˆå› ç‚º std::set çš„æ’å…¥å’Œåˆªé™¤éƒ½æ˜¯ O(log n)ï¼‰</p>
        </div>

        <div class="section">
            <h3>3. assign(l, r, v) - å€é–“è³¦å€¼</h3>
            <p><br>ç•¶æˆ‘å€‘æƒ³è¦æŠŠ [l, r] å…§çš„æ•¸è¨­ç‚º v æ™‚ï¼š</p>
            <pre><code class="language-css">void assign(int l, int r, int v) {
    it itr = split(r + 1), itl = split(l);
    ct.erase(itl, itr);
    ct.insert(Node(l, r, v));
}</code></pre>
            <p>ğŸ”¹ æ™‚é–“è¤‡é›œåº¦ï¼šO(m log n)ï¼ˆéš¨æ©Ÿæƒ…æ³ä¸‹ O(log n log log n)ï¼‰</p>
        </div>

        <div class="section">
            <h3>4. add(l, r, v) - å€é–“åŠ æ³•</h3>
            <p><br>å° [l, r] å…§çš„æ‰€æœ‰æ•¸åŠ ä¸Š vï¼š</p>
            <pre><code class="language-css">void add(int l, int r, int v) {
    it itr = split(r + 1), itl = split(l);
    for (; itl != itr; ++itl) {
        itl->v += v;
    }
}</code></pre>
            <p>ğŸ”¹ æ™‚é–“è¤‡é›œåº¦ï¼šO(log n log log n)ï¼ˆéš¨æ©Ÿæƒ…æ³ä¸‹è¡¨ç¾å„ªç•°ï¼‰</p>
        </div>

        <div class="section">
            <h3>5. kth(l, r, k) - å€é–“ç¬¬ k å°</h3>
            <p><br>å…ˆå°‡ [l, r] å…§çš„æ•¸æ”¶é›†åˆ° vectorï¼Œå†æ’åºå¾ŒæŸ¥æ‰¾ï¼š</p>
            <pre><code class="language-css">int kth(int l, int r, int k) {
    vector&lt;pair&lt;int, int&gt;&gt; a;
    it itr = split(r + 1), itl = split(l);
    for (it iter = itl; iter != itr; iter++)
        a.push_back({iter->v, iter->r - iter->l + 1});
    sort(a.begin(), a.end());
    for (auto &p : a) {
        k -= p.second;
        if (k <= 0) return p.first;
    }
    return -1;
}</code></pre>
            <p>ğŸ”¹ æ™‚é–“è¤‡é›œåº¦ï¼šO(log n + m log m)ï¼ˆæ’åºéœ€è¦ O(m log m)ï¼‰</p>
        </div>



        <h2>ç‚ºä»€éº¼ Chtholly Tree æ˜¯ã€Œé¨™åˆ†ç¥å™¨ã€ï¼Ÿ</h2>
        <p>Chtholly Tree ä¸¦ä¸æ˜¯çœŸæ­£çš„æœ€å„ªè§£ï¼Œä½†ï¼š</p>
        <ul>
            <li>éš¨æ©Ÿæ•¸æ“šæ™‚ï¼Œå®ƒçš„å€é–“æ•¸é‡è¼ƒå°‘ï¼Œæ‰€ä»¥è¡¨ç¾æ¯”ç·šæ®µæ¨¹å¥½ (O(log n log log n))ã€‚</li>
            <li>æƒ¡æ„æ¸¬è³‡ä¸‹ï¼Œå®ƒçš„å€é–“æ•¸é‡å¯é” O(n)ï¼Œè®Šæˆ O(n log n)ï¼Œç”šè‡³è¶…æ™‚ã€‚</li>
        </ul>
        <p>âš ï¸ Codeforces 896C è¨­è¨ˆç‚ºéš¨æ©Ÿæ•¸æ“šï¼Œå› æ­¤ Chtholly Tree è¡¨ç¾æ¥µä½³ï¼ä½†å¦‚æœä½ è¦è§£çš„æ˜¯æƒ¡æ„æ¸¬è³‡é¡Œï¼Œè«‹è¬¹æ…ä½¿ç”¨ï¼</p>

        <h2>ç¸½çµ</h2>
        <p>âœ… é©åˆå€é–“ä¿®æ”¹èˆ‡æŸ¥è©¢å•é¡Œ</p>
        <p>âœ… éš¨æ©Ÿæ•¸æ“šä¸‹è¡¨ç¾å„ªç•°</p>
        <p>âŒ æƒ¡æ„æ¸¬è³‡æ™‚å¯èƒ½è¶…æ™‚</p>
        <p>âœ… å¾ˆå¥½é¨™åˆ†</p>

        <h2>å®Œæ•´ä»£ç¢¼å¯¦ç¾</h2>
        <div class="section">
            <h3>C. Willem, Chtholly and Seniorious å®Œæ•´ä»£ç¢¼</h3>
            <pre><code class="language-css">#include &lt;bits/stdc++.h&gt;
using namespace std;
#define int long long

struct Node {
    int l, r;
    mutable int v;
    Node(int L, int R, int V) : l(L), r(R), v(V) {}
    bool operator&lt;(const Node &amp;o) const { return l &lt; o.l; }
};

set&lt;Node&gt; ct;
typedef set&lt;Node&gt;::iterator it;

int n, m; 

it split(int x) {
    if (x &gt; n) return ct.end();
    it iter = --ct.upper_bound(Node(x, 0, 0));
    if (iter-&gt;l == x) return iter;
    int l = iter-&gt;l, r = iter-&gt;r, v = iter-&gt;v;
    ct.erase(iter);
    ct.insert(Node(l, x - 1, v));
    return ct.insert(Node(x, r, v)).first;
}

void assign(int l, int r, int v) {
    it itr = split(r + 1), itl = split(l);
    ct.erase(itl, itr);
    ct.insert(Node(l, r, v));
}

void add(int l, int r, int v) {
    it itr = split(r + 1), itl = split(l);
    for (; itl != itr; ++itl) {
        itl-&gt;v += v;
    }
}

int kth(int l, int r, int k) {
    vector&lt;pair&lt;int, int&gt;&gt; a;
    it itr = split(r + 1), itl = split(l);
    for (it iter = itl; iter != itr; iter++)
        a.push_back({iter-&gt;v, iter-&gt;r - iter-&gt;l + 1});
    sort(a.begin(), a.end());
    for (auto &amp;p : a) {
        k -= p.second;
        if (k &lt;= 0) return p.first;
    }
    return -1;
}

int powmod(int a, int b, int mod) {
    int res = 1;
    a %= mod;
    while (b) {
        if (b &amp; 1) res = res * a % mod;
        a = a * a % mod;
        b &gt;&gt;= 1;
    }
    return res;
}

int sum(int l, int r, int x, int y) {
    it itr = split(r + 1), itl = split(l);
    int res = 0;
    for (; itl != itr; ++itl) {
        res = (res + (itl-&gt;r - itl-&gt;l + 1) * powmod(itl-&gt;v, x, y)) % y;
    }
    return res;
}

signed main() {
    int seed, vmax;
    cin &gt;&gt; n &gt;&gt; m &gt;&gt; seed &gt;&gt; vmax;

    auto rnd = [&amp;]() -&gt; int {
        int ret = seed;
        seed = (seed * 7 + 13) % 1000000007;
        return ret;
    };

    for (int i = 1; i &lt;= n; i++) {
        int a = rnd() % vmax + 1;
        ct.insert(Node(i, i, a));
    }

    for (int i = 1; i &lt;= m; i++) {
        int op = rnd() % 4 + 1;
        int l = rnd() % n + 1;
        int r = rnd() % n + 1;
        if (l &gt; r) swap(l, r);
        int x, y = 0;
        if (op == 3) x = rnd() % (r - l + 1) + 1;
        else x = rnd() % vmax + 1;
        if (op == 4) y = rnd() % vmax + 1;

        if (op == 1) add(l, r, x);
        else if (op == 2) assign(l, r, x);
        else if (op == 3) cout &lt;&lt; kth(l, r, x) &lt;&lt; endl;
        else if (op == 4) cout &lt;&lt; sum(l, r, x, y) &lt;&lt; endl;
    }

    return 0;
}</code></pre>
        </div>

        <h2>åƒè€ƒè³‡æ–™</h2>
        <ul>
            <li><a href="https://codeforces.com/problemset/problem/896/C" target="_blank">Codeforces 896C é¡Œç›®é€£çµ</a></li>
            <li><a href="https://oi-wiki.org/misc/odt/" target="_blank">ç‚æœµè‰æ ‘/é¢œè‰²æ®µå‡æ‘Š</a></li>
            <li>Chtholly Tree åŸè«–æ–‡èˆ‡ç›¸é—œè¨è«–</li>
        </ul>
    </div>
</body>

</html>